# ROS 2 Control Controller Configuration
# Following official controller_manager format
# Reference: https://control.ros.org/humble/doc/ros2_control/controller_manager/doc/userdoc.html
#
# NOTE: This configuration is currently DISABLED in the launch file.
# The system uses direct Gazebo diff drive plugin instead (see wheelchair.gazebo.xacro).
# To enable ros2_control:
# 1. Uncomment ros2_control plugin in wheelchair.gazebo.xacro
# 2. Comment out diff drive plugin in wheelchair.gazebo.xacro
# 3. Uncomment controller_manager_node in warehouse_with_robot.launch.py
# 4. Uncomment load_and_activate_controllers in warehouse_with_robot.launch.py

controller_manager:
  ros__parameters:
    # Controller update rate in Hz
    # Reference: https://control.ros.org/humble/doc/ros2_control/controller_manager/doc/userdoc.html
    update_rate: 100
    
    # Controller type declarations
    # These must match the controller class names exactly
    skid_steer_controller:
      type: diff_drive_controller/DiffDriveController
    
    joint_state_broadcaster:
      type: joint_state_broadcaster/JointStateBroadcaster

# ==================== SKID STEER CONTROLLER CONFIGURATION ====================
# DiffDriveController for 4-wheel skid steer robot
# Reference: https://control.ros.org/humble/doc/ros2_controllers/diff_drive_controller/doc/userdoc.html
skid_steer_controller:
  ros__parameters:
    # Wheel joint names - MUST match URDF joint names exactly
    # Consistent naming: wheel1=back_right, wheel2=back_left, wheel3=front_right, wheel4=front_left
    left_wheel_names: ["wheel2_joint", "wheel4_joint"]   # Left side: back_left (wheel2), front_left (wheel4)
    right_wheel_names: ["wheel1_joint", "wheel3_joint"]  # Right side: back_right (wheel1), front_right (wheel3)
    
    # Kinematic parameters (consistent with URDF)
    wheel_separation: 0.52      # Lateral separation between left and right wheel centers (m)
    wheels_per_side: 2          # Number of wheels per side (4-wheel skid steer)
    wheel_radius: 0.15          # Back wheel radius (m) - primary drive wheels
    
    # Wheel calibration multipliers (for fine-tuning)
    wheel_separation_multiplier: 1.0
    left_wheel_radius_multiplier: 1.0
    right_wheel_radius_multiplier: 1.0
    
    # Publishing configuration
    publish_rate: 50.0          # Odometry publishing rate (Hz)
    odom_frame_id: odom         # Odometry frame name
    base_frame_id: chassis      # Base frame name (must match URDF)
    
    # Odometry covariance matrices
    pose_covariance_diagonal: [0.001, 0.001, 0.001, 0.001, 0.001, 0.01]
    twist_covariance_diagonal: [0.001, 0.001, 0.001, 0.001, 0.001, 0.01]
    
    # Velocity limits
    min_linear_x_velocity: -1.0
    max_linear_x_velocity: 1.0
    min_linear_y_velocity: -1.0   # For holonomic robots (not used in diff drive)
    max_linear_y_velocity: 1.0    # For holonomic robots (not used in diff drive)
    min_angular_velocity: -2.0
    max_angular_velocity: 2.0
    
    # Acceleration limits
    linear_x_velocity_limit: 1.0
    linear_y_velocity_limit: 1.0
    angular_velocity_limit: 2.0
    
    # Control mode
    open_loop: true              # Open loop control (no encoder feedback)
    
    # TF and odometry publishing
    enable_odom_tf: true         # Enable odometry TF publishing
    publish_odom: true           # Enable odometry message publishing
    
    # Command timeout
    cmd_vel_timeout: 0.5         # Timeout for cmd_vel commands (seconds)
    
    # Velocity message format
    use_stamped_vel: false       # Use unstamped velocity messages
    
    # Velocity filtering
    velocity_rolling_window_size: 10
